![Swift](https://img.shields.io/badge/Swift-5.10-orange)
![Xcode](https://img.shields.io/badge/Xcode-15.3-blue)

# 옷장리턴  <img width="100" alt="image" src="https://github.com/user-attachments/assets/63a1a750-64c0-4154-937d-84c37416a771" align="left">
> 중고 의류를 사고팔고, 패션 스타일을 공유할 수 있는 앱이에요 ✨

<br>

## 프로젝트 정보
- 개발 기간: `2024.08.14 ~ 2024.08.31`
- 최소 지원 버전: `iOS 16.0`

<br>

## 사용 기술

- 언어: `Swift` `iOS`
- 프레임워크: `UIKit`
- 아키텍처: `MVVM`
- 그 외 기술:
  - `CodeBaseUI` `SnapKit`
  - `RxSwift` `RxCocoa`
  - `Alamofire`
  - `UserDefaults`
  - `iamport-ios`
  - `PhotosUI`
  - `IQKeyboardManager`
  - `Toast`
  - `Firebase`
 
<br>

## 주요 화면 및 기능

### 홈 화면
> - 화면을 아래로 스크롤 하여 판매 중인 상품 목록을 계속해서 조회할 수 있습니다.
> - 상품을 선택하면 상품 상세 화면으로 화면 전환됩니다.
> - 하트 아이콘 버튼을 선택하여 좋아요 및 좋아요 취소를 할 수 있습니다.
> - 버튼을 선택하면 상품 등록 작성 화면으로 화면 전환됩니다.
> - 화면을 아래로 당겨서 새로고침을 할 수 있습니다.

| 홈 화면 |
| :---: |
| <img src="https://github.com/user-attachments/assets/87a9298c-78bb-49fc-8119-cfae2f50bb55" width="200"> |

### 상품 등록 화면
> - 카메라 아이콘 버튼을 선택하면 앨범에서 최대 5장의 사진을 선택할 수 있습니다.
> - 제목, 가격, 브랜드 등 판매할 상품에 관한 정보들을 입력할 수 있습니다.
> - 완료 버튼을 선택하면 입력한 내용을 토대로 상품이 등록되고 홈 화면에서 조회할 수 있습니다.
> -  x 버튼을 선택하면 상품 등록 취소를 묻는 Alert이 표시됩니다.

| 상품 등록 화면 |
| :---: |
| <img src="https://github.com/user-attachments/assets/1b952995-a48e-4cc8-b84f-3142ad796797" width="200"> |

### 상품 상세 화면
> - 우측 상단의 메뉴 버튼을 선택하여 내용을 수정 및 삭제할 수 있습니다.
> - 좌우로 스와이프하여 이전이나 다음 상품 사진을 볼 수 있습니다.
> - 하트 아이콘 버튼을 선택하여 좋아요 및 좋아요 취소를 할 수 있습니다.
> - 말풍선 아이콘 버튼을 선택하면 댓글 조회 화면으로 화면 전환됩니다.
> - 구매하기 버튼을 선택하면 KG 이니시스 결제 화면으로 화면 전환됩니다.

| 상품 상세 화면 |
| :---: |
| <img src="https://github.com/user-attachments/assets/9d04ea48-4830-41c5-90c5-78182315aa4f" width="200"> | 

### 좋아요 화면
> - 상품 탭을 선택하면 좋아요한 상품 목록을 조회할 수 있습니다.
> - 피드 탭을 선택하면 좋아요한 피드 목록을 조회할 수 있습니다.
> - 조회된 목록 중에서 원하는 항목을 선택하면 상세 화면으로 화면 전환됩니다.

| 좋아요 화면 |
| :---: |
| <img src="https://github.com/user-attachments/assets/85555b5e-b4c3-4bc7-b503-4057ef611854" width="200"> | 

### 프로필 화면
> - 로그인한 사용자의 프로필 이미지, 닉네임, 등록한 피드 개수, 등록한 판매 상품 개수, 팔로워 수, 팔로잉 수에 대한 정보를 조회할 수 있습니다.
> - 우측 상단의 설정 버튼을 선택하여 로그아웃을 할 수 있습니다.
> - 프로필 편집 버튼을 선택하면 프로필 수정 화면으로 화면 전환됩니다.
> - 피드 탭을 선택하면 사용자가 등록한 피드 목록을 조회할 수 있습니다.
> - 판매 중인 상품 탭을 선택하면 사용자가 등록한 상품 목록을 조회할 수 있습니다.
> - 구매 내역 탭을 선택하면 결제한 상품 목록을 조회할 수 있습니다.

| 프로필 화면 |
| :---: |
| <img src="https://github.com/user-attachments/assets/3678553c-b32a-4815-93f8-977e869e0e7e" width="200"> | 


<br>

## 주요 기술
- MVVM Pattern을 도입하여 뷰 컨트롤러와 뷰는 화면을 그리는 역할에만 집중하게 하고, 데이터 관리와 로직 처리는 ViewModel에서 담당하도록 분리했습니다.
- ViewModel에 Input-Output Pattern을 적용하여 데이터 흐름을 명확하게 했습니다.
- RxSwift와 RxCocoa를 활용하여 비동기 이벤트 스트림을 관리하고, UI와 데이터 간의 반응형 바인딩을 구현했습니다.
- Router Pattern을 사용하여 모든 API를 한 곳에서 관리하기 쉽게 했습니다.
- 카드 결제를 위해 포트원(iamport-ios)을 연동하여 앱 내에서의 결제 기능을 구현했습니다.
- 결제 영수증을 검증하여 구매 완료 처리를 진행할 수 있도록 했습니다.
- Access Token 만료 시 Refresh Token을 이용해 새 토큰을 발급받아 저장하고 요청하는 기능을 구현했습니다.
- Cursor-based Pagination 기능을 구현했습니다.
- PhotosUI를 활용하여 사용자가 앨범에 있는 사진을 업로드할 수 있는 기능을 구현했습니다.
- multipart/form-data 타입을 사용하여 서버에 이미지 파일을 전송할 수 있도록 했습니다.
- Firebase Cloud Messaging을 이용해 Push Notification을 수신할 수 있도록 했습니다.
- final 키워드와 접근 제어자를 사용하여 컴파일 최적화를 이루고, 코드의 안전성과 성능을 향상했습니다.
- BaseViewController를 사용해 여러 뷰 컨트롤러에서 공통으로 사용되는 초기화 코드를 구조화했습니다.

<br>

## 문제 및 해결 과정

### 1. 앨범에서 선택한 이미지가 추가되지 않는 문제

#### 문제 상황
상품 등록 화면에서 사진 첨부 기능을 구현했습니다. 사용자가 앨범에서 선택한 이미지들이 목록에 표시되어, 추가된 이미지를 확인할 수 있어야 했습니다. 그러나 선택한 이미지들이 추가되지 않아 목록에 표시되지 않는 문제가 발생하였습니다.

#### 문제 원인

PHPickerViewController에서 선택한 자산들은 JPEG 이미지 데이터로 변환된 후 배열에 담겨 ViewModel로 전달됩니다. ViewModel은 받은 이미지 데이터를 바탕으로 CollectionView에 이미지 목록을 업데이트하는 흐름을 처리하고 있었습니다. 그러나 `loadObject(ofClass:)` 메서드가 비동기적으로 실행됨에 따라, 해당 메서드의 작업이 완료되기 전에 다음 줄인 배열을 전달하는 코드가 실행되었고, 이로 인해 ViewModel에는 항상 빈 배열이 전달됐기 때문에 발생하였습니다.













